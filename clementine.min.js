/**
 * ClementineJS | 0.4 | 08.23.2012
 * https://github.com/brew20k/clementine
 * Copyright (c) 2012 Kevin Kinnebrew
 */
(function(a){var b={},c={};b.get=function(a,b,d){var e=this,f=[],g;if(!c.hasOwnProperty(a))throw"Path "+a+" has not been loaded";$("<div>"+c[a]+"</div>").children().each(function(){f.push($(this))});for(var h=0;h<f.length;h++){if(typeof b!="undefined"&&f[h].attr("data-control")!==b)continue;if(typeof d!="undefined"&&f[h].attr("data-name")!==d)continue;return f[h]}throw"Could not find view "+b+" at "+a},b.fetch=function(a,b,c){return $.ajax({async:c!==!0,cache:!1,contentType:"text/html; charset=utf-8",dataType:"text",timeout:1e4,url:a,success:function(c){b(a,c)},error:function(){throw"Error: template not found"}}).responseText},b.load=function(a,b){function f(a,d){c[a]=d,e--,e===0&&b()}var d,e=a.length;for(var g=0;g<a.length;g++)d=a[g],this.fetch(a[g],proxy(f,this))},a.View=b})(Clementine),function(a){var b,c=a.Collection,d=a.Model;b=Class.extend({initialize:function(a){this.target=a,this.template=a.clone(),this.loaded=!1},bind:function(a,b){this.loaded&&this.unbind();if(a instanceof Array)this.bindList(this.target,a);else if(typeof a=="object")this.bindData(this.target,a);else return;this.loaded=!0,typeof b=="function"&&b.call(this)},bindList:function(a,b,c){var d,e,f,g=a.find("[itemscope]:first"),h=a.clone().empty();if(!g.length){a.remove();return}g.remove(),e=g.clone();if(b instanceof Array)for(var i=0;i<b.length;i++){d=e.clone(),h.append(d);try{f=b[i][c]}catch(j){f=undefined}this.bindData(d,b[i],f)}a.replaceWith(h)},bindData:function(a,b,c){function g(b){var c=[];return a.find(b).each(function(){var b=!1,d=$(this).parent();while(d.length!==0&&!b){if($(d).not(a).length===0){b=!0;break}if($(d).not("[data-control]").length===0){b=!1;break}d=$(d).parent()}b&&c.push($(this))}),c}var d=[],e,f;c&&a.attr("itemid",c);if(typeof b=="string"&&a.has("[itemscope]")){a.text(b);return}d=g.call(this,"[itemprop]");for(var h=0;h<d.length;h++)e=d[h],f=e.attr("itemprop"),b.hasOwnProperty(f)?b[f]instanceof Array?this.bindList(e,b[f]):typeof b[f]=="object"?this.bindData(e,b[f]):typeof b[f]=="string"&&e.text(b[f]):e.remove()},unbind:function(){this.target.replaceWith(this.template.clone())},destroy:function(){delete this.target,delete this.template,delete this.loaded}}),a.Binding=b}(Clementine),function(a){function f(a,b){b=$(b).eq(0),a=$(a)[0];for(var c=0;c<a.attributes.length;c++){var d=a.attributes[c];b.attr(d.name,d.value)}}var b,c=a.Binding,d=a.Browser,e=a.View;b=Class.extend({initialize:function(a,c,d){var g=this,h=[],i=[];this.app=d,this.views={},this.elements={},this.data={},this.source=c.clone(),this.state="",this.loading=!1,this.unloading=!1,this.loaded=!1,this.visible=!1,this.appearing=!1,this.disappearing=!1,this.loadEvts=[],this.unloadEvts=[],this.showEvts=[],this.hideEvts=[],this.queue=[],this.running=!1,this.bindings={};var j;if(typeof c!="undefined")this.target=$(c),j=$(c).get(0);else throw"Invalid target";this._parent=typeof a!="undefined"?a:null,this._parent===null&&this.target.removeAttr("data-root");for(var k=0,l=j.attributes.length;k<l;k++)j.attributes[k].name.match(/data-/)&&(this.data[j.attributes[k].name.replace(/data-/,"")]=j.attributes[k].value);var m=function(a){var b=[];return this.target.find(a).each(function(){var a=!1,c=$(this).parent();while(c.length!==0&&!a){if($(c).not($(g.target)).length===0){a=!0;break}if($(c).not("[data-control]").length===0){a=!1;break}c=$(c).parent()}a&&b.push(this)}),b};h=m.call(this,"[data-control]"),i=m.call(this,"[data-name]:not([data-control])"),console.log(this.data.name+" "+"Initialized");for(k=0,l=h.length;k<l;k++){var n=$(h[k]),o=n.attr("data-name"),p=n.attr("data-control"),q=n.attr("data-template"),r=typeof q!="undefined"&&q.length>0;o||(o=n.attr("data-control"));if(r){var s=e.get(q,p,o);n.html($(s).html()),f(s,n),n.removeAttr("data-template")}var t=b.get(p);this.views[o]=new t(this,n,d)}for(k=0,l=i.length;k<l;k++){var u=$(i[k]),v=u.attr("data-name");typeof v!="undefined"&&v.length>0&&(this.elements[v]=u.removeAttr("data-name").addClass(v))}this.type=this.getType(),this.data.name=this.data.name||this.data.control,this.data.state&&(this.state=this.data.state),this.target.addClass(this.getClasses()),this.target.removeAttr("data-control").removeAttr("data-name").removeAttr("data-state")},add:function(a,b,c){this.queue.push({fn:a,args:b,wait:c}),this.running||this.next()},next:function(){this.running=!0;var a=this.queue.shift();a?(a.fn.apply(this,a.args),a.fn===this._setState&&setTimeout(proxy(function(){this.next()},this),a.wait)):this.running=!1},getType:function(){return"view"},getClasses:function(){var a=typeof this.typeList!="undefined"?this.typeList:"";return a+" "+this.data.name?this.data.name:""},getBindings:function(){return{}},getRoutes:function(){return{}},setRoute:function(a,b){var c=this.getRoutes(),d=a.clone(),e=d.shift();if(c.hasOwnProperty(e)){var f=c[e];for(var g in f){var h=f[g];b&&(h=[h.pop()]);for(var i=0;i<h.length;i++){var j=h[i];if(typeof j=="object"){var k=Object.keys(j).pop();this.getView(g).setState(k,j[k])}else typeof j=="string"&&this.getView(g).setState(j)}d.length>0&&this.getView(g).setRoute(d,b)}}},getState:function(){return this.state},setState:function(a,b){return this.add(this._setState,[a],b||0),this},_setState:function(a,b){if((this.hasState(a)||!this.loaded)&&!b)return;a&&console.log(this.data.name+" state is "+a),this.target.removeClass(this.state),this.target.addClass(a),this.state=a},hasState:function(a){return this.state===a},load:function(){return this.add(this._load),this},show:function(){return this.add(this._show),this},hide:function(){return this.add(this._hide),this},unload:function(){return this.add(this._unload),this},_load:function(){if(this.loading||this.loaded){this.next();return}this.loading=!0,this._setState(this.state,!0),this.loadEvts.push(this.on("_load",this.onLoad,this)),this.loadEvts.push(this.on("_loaded",this.onDidLoad,this)),this.onWillLoad()},_show:function(){if(this.visible||this.appearing||!this.loaded){this.next();return}this.appearing=!0,this.showEvts.push(this.on("_appear",this.onAppear,this)),this.showEvts.push(this.on("_appeared",this.onDidAppear,this)),this.onWillAppear()},_hide:function(){if(!this.visible||this.disappearing){this.next();return}this.disappearing=!0,this.hideEvts.push(this.on("_disappear",this.onDisappear,this)),this.hideEvts.push(this.on("_disappeared",this.onDidDisappear,this)),this.onWillDisappear()},_unload:function(){if(this.unloading||!this.loaded){this.next();return}if(this.visible&&!this.disappearing){this.hide().unload();return}this.unloadEvts.push(this.on("_unload",this.onUnload,this)),this.unloadEvts.push(this.on("_unloaded",this.onDidUnload,this)),this.unloading=!0,this.onWillUnload()},onWillLoad:function(){console.log(this.data.name+" "+"Will Load"),this.fire("_load")},onLoad:function(){var a=Object.keys(this.views).length;if(a===0)this.fire("_loaded");else for(var b in this.views){var c=this.views[b];c.once("load",proxy(function(){a--,a===0&&this.fire("_loaded")},this)),c.load()}},onDidLoad:function(){for(var a=0,b=this.loadEvts.length;a<b;a++)this.loadEvts[a].detach();console.log(this.data.name+" "+"Did Load"),this.loadEvts=[],this.loading=!1,this.loaded=!0,this.fire("load"),this.next()},onWillUnload:function(){console.log(this.data.name+" "+"Will Unload"),this.fire("_unload")},onUnload:function(){var a=Object.keys(this.views).length;if(a===0)this.target.remove(),this.fire("_unloaded");else for(var b in this.views){var c=this.views[b];c.once("unload",proxy(function(){a--,a===0&&(this.target.remove(),this.fire("_unloaded"))},this)),c.unload()}},onDidUnload:function(){console.log(this.data.name+" "+"Did Unload");for(var a=0,b=this.unloadEvts.length;a<b;a++)this.unloadEvts[a].detach();this.unloadEvts=[],this.unloading=!1,this.loaded=!1,this.fire("unload"),this.next()},onWillAppear:function(){console.log(this.data.name+" "+"Will Appear");var a=this.getBindings();for(var b in a){var c=a[b];for(var e in c){var f=null;typeof c[e]=="function"?f=c[e]:this.hasOwnProperty(c[e])&&(f=this[c[e]]),e==="touchclick"&&(e=d.touch?"touchend":"click");if(f===null){var g=e.charAt(0).toUpperCase()+e.slice(1);f=c[e]===!0&&typeof this["on"+g]=="function"?this["on"+g]:null}b==="$target"?this.target.on(e,$.proxy(f,this)):f!==null&&this.views.hasOwnProperty(b)?this.getView(b).on(e,$.proxy(f,this)):f!==null&&this.elements.hasOwnProperty(b)&&this.getElement(b).on(e,$.proxy(f,this))}}this.fire("_appear")},onAppear:function(a){var b=Object.keys(this.views).length;if(b===0)this.fire("_appeared");else for(var c in this.views){var d=this.views[c];d.once("appear",proxy(function(){b--,b===0&&this.fire("_appeared")},this)),d.show()}},onDidAppear:function(a){console.log(this.data.name+" "+"Did Appear");for(var b=0,c=this.showEvts.length;b<c;b++)this.showEvts[b].detach();this.showEvts=[],this.appearing=!1,this.visible=!0,this.fire("appear"),this.next()},onWillDisappear:function(){console.log(this.data.name+" "+"Will Disappear");for(var a in this.views)this.getView(a).detach();for(var b in this.elements)this.getElement(b).unbind();this.fire("_disappear")},onDisappear:function(a){var b=Object.keys(this.views).length;if(b===0)this.fire("_disappeared");else for(var c in this.views){var d=this.views[c];d.once("disappear",proxy(function(){b--,b===0&&this.fire("_disappeared")},this)),d.hide()}},onDidDisappear:function(a){console.log(this.data.name+" "+"Did Disappear");for(var b=0,c=this.hideEvts.length;b<c;b++)this.hideEvts[b].detach();this.hideEvts=[],this.disappearing=!1,this.visible=!1,this.fire("disappear"),this.next()},getViews:function(){return this.views},getView:function(a){if(a instanceof b)return a;if(typeof this.views[a]!="undefined")return this.views[a];throw'Error: View "'+a+'" not found'},getElement:function(a){if(typeof this.elements[a]!="undefined")return this.elements[a];throw'Error: Element "'+a+'" not found'},addView:function(a,c,d){var f=b.get(a),g=e.get(d,a,c);return f&&(this.views[c]=new f(this,g,this.app)),this.views[c]},removeView:function(a){this.hasView(a)&&(this.views[a].hide().unload().destroy(),delete this.views[a])},hasView:function(a){return typeof this.views[a]!="undefined"},hasElement:function(a){return typeof this.elements[a]!="undefined"},bind:function(a,b){if(!this.hasElement(a))return;this.bindings.hasOwnProperty(a)&&(this.bindings[a].unbind(),delete this.bindings[a]),this.bindings[a]=new c(this.getElement(a)),this.bindings[a].bind(b)},unbind:function(a){if(!this.hasElement(a))return;this.bindings.hasOwnProperty(a)&&(this.bindings[a].unbind(),delete this.bindings[a])},toString:function(){return"["+this.getType()+" "+this.data.name+"]"},destroy:function(){for(var a in this.views)this.views[a].destroy(),delete this.views[a];for(var b in this.elements)delete this.elements[b];delete this.target,delete this._parent}}).include(Events),b.views={view:b},b.prototype.typeList="",b.extend=function(a){var c=Class.extend.call(this,a),d=a.getType(),e=["getType"];for(var f=0,g=e.length;f<g;f++){if(!a.hasOwnProperty(e[f]))throw"Class missing '"+e[f]+"()' implementation";c[e[f]]=a[e[f]]}return c.prototype.typeList+=(c.prototype.typeList===""?"":" ")+d,c.extend=b.extend,b.views[d]=c},b.get=function(a){if(a==="view")return this;if(!this.views.hasOwnProperty(a))throw"View '"+a+'" not found';return this.views[a]},a.ViewController=b}(Clementine),function(a){var b,c=a.Loader,d=a.View,e=a.ViewController;b=Class.extend({initialize:function(a){if(!a.hasOwnProperty("name")||!a.hasOwnProperty("required"))throw"Invalid application";this.name=a.name,this.required=a.required,this.loaded=!1,this.online=!1,this.env="PROD";for(var b=0,d=this.config.required.length;b<d;b++)c.loadModule(this.config.required[b])},setEnvironment:function(a){this.env=a},setLogging:function(a){this.levels=a},registerViews:function(a){d.load(a)},onHashChange:function(a){var b=location.hash.replace("#").split("/");this.root.setRoute(b,a)},onReady:function(){this.rootEl=$("[data-root]");var a=e.get(this.rootEl.attr("data-control"));this.root=new a(null,this.rootEl,this),this.root.load().show(),this.online?this.root.goOnline():this.root.goOffline(),this.onHashChange()},launch:function(){if(this.loaded)return;!this.levels||!this.levels.hasOwnProperty(this.env)?Log.setLevel("DEBUG"):Log.setLevel(this.levels[this.env])}}),a.Application=b}(Clementine);