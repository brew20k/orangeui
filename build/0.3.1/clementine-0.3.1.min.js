/**
 * ClementineJS | 0.3.1 | 09.27.2012
 * https://github.com/brew20k/clementine
 * Copyright (c) 2012 Kevin Kinnebrew
 */
function noop(){}function clone(a){var b,c=a instanceof Array?[]:{};for(b in a){if(b==="clone")continue;a[b]&&a[b]instanceof Date?c[b]=new Date(a[b]):a[b]&&typeof a[b]=="object"?c[b]=clone(a[b]):c[b]=a[b]}return c}function proxy(a,b){var c=b;return function(){return a.apply(c,arguments)}}function firstChildren(a,b){var c=[];return a.find(b).each(function(){var b=!1,d=$(this).parent();while(d.length!==0&&!b){if($(d).not($(a)).length===0){b=!0;break}if($(d).not("[data-control]").length===0){b=!1;break}d=$(d).parent()}b&&c.push($(this))}),c}jQuery.fn.outerHTML=function(a){return a?this.before(a).remove():jQuery("<p>").append(this.eq(0).clone()).html()},function(){function k(){function d(){--b===0&&a.resolve()}var a=new c(this),b=arguments.length;for(var e=0;e<arguments.length;e++)arguments[e].then(d);return a}function l(){var a=arguments,b=a[0],c=typeof a[1]=="function"?a[1]:null,d=a[2];h.Loader.addModule(b,c,d)}function m(){var a=Array.prototype.slice.call(arguments),b=a[a.length-1],c=clone(a).splice(0,a.length-1);if(typeof c[0]!="function")for(var d=0,e=c.length;d<e;d++)h.Loader.loadModule(c[d]);b.call(window,h)}function n(a){if(typeof h.modules[a]!==undefined)return h.modules[a];throw"Could not require module"}var a,b,c,d,e,f,g,h={},i=/[^A-Za-z:0-9_\[\]]/g,j=/[^A-Za-z\-_]/g;b=function(){function c(){}var a=!1,b=/\b_super\b/;return c.extend=function(d){function h(){!a&&this.initialize&&this.initialize.apply(this,arguments)}var e,f,g=this.prototype;a=!0,e=new this,a=!1;for(f in d)e[f]=typeof d[f]=="function"&&typeof g[f]=="function"&&b.test(d[f])?function(a,b){return function(){var c=this._super;this._super=g[a];var d=b.apply(this,arguments);return this._super=c,d}}(f,d[f]):d[f];return h.prototype=e,h.prototype.constructor=h,h.extend=c.extend,h.include=c.include,h},c.include=function(a){var b,c,d;if(!a)throw"Missing definition";for(b in a)c=a[b],Array.prototype.indexOf.call(["extend","include"],b)<0&&(this.prototype[b]=c);return this},c}(),e=function(){function a(a,b,c,d){this.bubbles=!0,this.currentTarget=b,this.data=d,this.target=c,this.type=a}return a.prototype.stopPropagation=function(){this.bubbles=!1},a}(),f=function(){function a(a,b,c){this.call=c,this.ev=b,this.target=a}return a.prototype.detach=function(){this.target.detach(this.ev,this.call),delete this.target,delete this.ev,delete this.call},a}(),d={on:function(a,b,c){var d=typeof c!="undefined"?proxy(b,c):b;return this._listeners||(this._listeners={}),this._listeners.hasOwnProperty(a)||(this._listeners[a]=[]),this._listeners[a].push(d),new f(this,a,d)},once:function(a,b,c){var d=typeof c!="undefined"?proxy(b,c):b,e=function(){b.apply(this,arguments),this.detach(a,d)};this.on(a,e)},fire:function(a,b){var c=this.parent||null,d=a;typeof a=="string"&&(a=new e(a,this,this,b));if(typeof a.type!="string")throw"Error: Invalid 'type' when firing event";this._listeners||(this._listeners={});if(this._listeners[a.type]instanceof Array){var f=this._listeners[a.type];for(var g=0,h=f.length;g<h;g++)f[g].call(this,a,b)}c!=null&&a.bubbles&&d[0]!=="_"&&(a.currentTarget=this.parent,c.fire.call(c,a,b))},detach:function(a,b){var c=[];this._listeners||(this._listeners={});if(typeof a=="undefined")this._listeners={};else if(this._listeners[a]instanceof Array)if(typeof b!="undefined"){c=this._listeners[a];for(var d=0,e=c.length;d<e;d++)if(c[d]===b){c.splice(d,1);break}}else this._listeners[a]=[]}},g=function(){var a={},b={},c={};return h.modules={},{addModule:function(b,c,d){if(!b.match(/[\^\-A-Za-z_]/g))throw"Invalid module name";var e={name:b,fn:c,req:d!==undefined?d:[]};a[b]=e},loadModule:function(d){if(b.hasOwnProperty(d))return;if(a[d]!==undefined){b[d]=!0;for(var e=0,f=a[d].req.length;e<f;e++){if(a[d].req[e]===d)continue;this.loadModule(a[d].req[e])}a[d].fn.call(window,c),h.modules[d]=c}}}}(),c=function(){function a(a){this.context=a,this.resolved=!1,this.bindings=[]}return a.prototype.resolve=function(){this.resolved=!0;for(var a=0;a<this.bindings.length;a++)this.bindings[a].fn.apply(this.context,this.bindings[a].args);this.bindings=[]},a.prototype.then=function(a,b){this.resolved?a.apply(this.context,b||[]):this.bindings.push({fn:a,args:b||[]})},a}(),a={touch:"ontouchstart"in window||window.DocumentTouch&&document instanceof DocumentTouch,location:"geolocation"in navigator},h=this.Clementine={},h.version="0.5.0",h.add=l,h.use=m,h.include=this.include=n,h.when=k,h.Browser=a=a,h.Class=this.Class=b,h.Deferred=c,h.Events=this.Events=d,h.Loader=g}.call(this),Array.prototype.clone=function(){return this.slice(0)},Array.prototype.indexOf=[].indexOf||function(a){for(var b=0,c=this.length;b<c;b++)if(b in this&&this[b]===a)return b;return-1},Array.prototype.first=[].first||function(){return this.length?this[0]:null},Array.prototype.last=[].last||function(){return this.length?this[this.length-1]:null},function(a){var b,c=a.Binding,d=a.Browser,e=a.View;b=Class.extend({initialize:function(a,c){var d=this,f=[],g=[];this.loading=!1,this.unloading=!1,this.loaded=!1,this.visible=!1,this.appearing=!1,this.disappearing=!1,this.changing=!1,this.loadEvts=[],this.unloadEvts=[],this.showEvts=[],this.hideEvts=[],this.views={},this.elements={},this.events=[],this.data={},this.params={},this.source=c.clone();if(typeof c!="undefined"){this.target=$(c);var h=$(c).get(0)}else{this.target=e.get(this.getDefaultView());if(this.target===null)throw"Invalid target"}this.parent=typeof a!="undefined"?a:null,this.parent===null&&this.target.removeAttr("data-root");for(var i=0,j=h.attributes.length;i<j;i++)h.attributes[i].name.match(/data-/)&&(this.data[h.attributes[i].name.replace(/data-/,"")]=h.attributes[i].value);var k=function(a){var b=[];return this.target.find(a).each(function(){var a=!1,c=$(this).parent();while(c.length!==0&&!a){if($(c).not($(d.target)).length===0){a=!0;break}if($(c).not("[data-control]").length===0){a=!1;break}c=$(c).parent()}a&&b.push(this)}),b};f=k.call(this,"[data-control]"),g=k.call(this,"[data-name]:not([data-control])"),this.data.name||(this.data.name=this.data.control),console.log(this.data.name+" Initialized");for(var i=0,j=f.length;i<j;i++){var l=$(f[i]),m=l.attr("data-name"),n=l.attr("data-control"),o=l.attr("data-template"),p=typeof o!="undefined"&&o.length>0;if(p){var q=e.get(o);l.html($(q).html()),cloneAttributes(q,l),l.removeAttr("data-template")}var r=b.get(n);m||(m=n),this.views[m]=new r(this,l)}for(var i=0,j=g.length;i<j;i++){var s=$(g[i]),m=s.attr("data-name");typeof m!="undefined"&&m.length>0&&(this.elements[m]=s.removeAttr("data-name").addClass(m))}this.addClasses(),this.target.removeAttr("data-control").removeAttr("data-name"),this.target.addClass("hidden"),this.type=this.getType(),this.name=this.data.name,this.setup()},setup:function(){},getType:function(){return"ui-view"},getStates:function(){return{}},getDefaultState:function(){return null},getDefaultView:function(){return null},setState:function(a){if(!a||a.length===0)this.getDefaultState()?a=[this.getDefaultState()]:a=[];var b=a.slice(0),c=a.shift(),d=a.slice(0),e=this.state||this.getDefaultState(),f=this.getStates();if(Object.keys(f).length===0){for(var g in this.views)this.getView(g).setState(b.slice(0));return}f.hasOwnProperty(c)&&f[c].call(this,e,d),this.state=c},addClasses:function(){this.target.addClass(this.target.get(0).className+" "+this.types+" "+this.data.name)},getTriggers:function(){return[]},getBindings:function(){return{}},load:function(){if(this.loading||this.loaded)return;return this.loading=!0,this.loadEvts.push(this.on("_load",this.onLoad,this)),this.loadEvts.push(this.on("_loaded",this.onDidLoad,this)),this.onWillLoad(),this},onWillLoad:function(){this.fire("_load")},onLoad:function(){for(var a in this.views)this.views[a].load();this.fire("_loaded")},onDidLoad:function(){for(var a=0,b=this.loadEvts.length;a<b;a++)this.loadEvts[a].detach();this.loadEvts=[],this.loading=!1,this.loaded=!0,this.fire("load")},unload:function(){if(this.unloading||!this.loaded)return;if(this.visible&&!this.disappearing){this.vEvt=this.on("disappear",function(a){this.unload(),this.vEvt.detach()},this),this.hide();return}return this.unloadEvts.push(this.on("_unload",this.onUnload,this)),this.unloadEvts.push(this.on("_unloaded",this.onDidUnload,this)),this.unloading=!0,this.onWillUnload(),this},onWillUnload:function(){this.fire("_unload")},onUnload:function(){for(var a in this.views)this.views[a].unload();this.fire("_unloaded")},onDidUnload:function(){for(var a=0,b=this.unloadEvts.length;a<b;a++)this.unloadEvts[a].detach();this.unloadEvts=[],this.unloading=!1,this.loaded=!1,this.fire("unload")},show:function(){if(this.visible||this.appearing)return;return this.appearing=!0,this.showEvts.push(this.on("_appear",this.onAppear,this)),this.showEvts.push(this.on("_appeared",this.onDidAppear,this)),this.onWillAppear(),this},onWillAppear:function(){var a=this.getBindings(),b,c;for(var e in a){var f=a[e];for(var g in f){var h=null;typeof f[g]=="function"?h=f[g]:this.hasOwnProperty(f[g])&&(h=this[f[g]]),g=="touchclick"&&(g=d&&d.touch?"touchend":"click");if(h===null){var i=g.charAt(0).toUpperCase()+g.slice(1);h=f[g]===!0&&typeof this["on"+i]=="function"?this["on"+i]:null}c=e.match(/\(.+\)/gi),e.match(/\$target/)?c&&c.length>0?this.target.on(g,c.pop().replace(/[()]/g,""),$.proxy(h,this)):this.target.on(g,$.proxy(h,this)):h!==null&&this.views.hasOwnProperty(e)?this.getView(e).on(g,$.proxy(h,this)):h!==null&&(c&&c.length>0?(b=e.replace(/\(.+\)/gi,""),this.getElement(b).on(g,c.pop().replace(/[()]/g,""),$.proxy(h,this))):this.elements.hasOwnProperty(e)&&this.getElement(e).on(g,$.proxy(h,this)))}}this.fire("_appear")},onAppear:function(){for(var a in this.views)this.views[a].show();this.target.removeClass("hidden"),this.fire("_appeared")},onDidAppear:function(){for(var a=0,b=this.showEvts.length;a<b;a++)this.showEvts[a].detach();this.showEvts=[],this.appearing=!1,this.visible=!0,this.fire("appear")},hide:function(){if(!this.visible||this.disappearing)return;return this.disappearing=!0,this.hideEvts.push(this.on("_disappear",this.onDisappear,this)),this.hideEvts.push(this.on("_disappeared",this.onDidDisappear,this)),this.onWillDisappear(),this},onWillDisappear:function(){for(var a in this.views)this.getView(a).detach();for(var b in this.elements)this.getElement(b).unbind();this.fire("_disappear")},onDisappear:function(){this.target.addClass("hidden");for(var a in this.views)this.views[a].hide();this.fire("_disappeared")},onDidDisappear:function(){for(var a=0,b=this.hideEvts.length;a<b;a++)this.hideEvts[a].detach();this.hideEvts=[],this.disappearing=!1,this.visible=!1,this.fire("disappear")},getView:function(a){if(a instanceof b)return a;if(typeof this.views[a]!="undefined")return this.views[a];throw'Error: View "'+a+'" not found'},getElement:function(a){if(typeof this.elements[a]!="undefined")return this.elements[a];throw'Error: Element "'+a+'" not found'},hasView:function(a){return typeof this.views[a]!="undefined"},hasElement:function(a){return typeof this.elements[a]!="undefined"},setView:function(a,b){console.log(this);if(this.views.hasOwnProperty(a))throw"View already exists";this.views[a]=b},clearView:function(a){this.views.hasOwnProperty(a)&&(this.views[a].destroy(),delete this.views[a])},bindData:function(a,b,c){var d=a==="$target"?this.target:this.getElement(a),e=firstChildren(d,"[itemprop]"),f;for(var g=0;g<e.length;g++)f=e[g].attr("itemprop"),f&&(e[g].get(0).tagName==="IMG"?b.hasOwnProperty(f)&&e[g].attr("src",b[f]):e[g].get(0).tagName==="SELECT"||e[g].get(0).tagName==="INPUT"?b.hasOwnProperty(f)&&e[g].val(b[f]):b.hasOwnProperty(f)?e[g].text(b[f]):c||e[g].text(""))},setParam:function(a,b){this.params[a]=b},getParam:function(a){return this.params[a]},clearParam:function(a){delete this.params[a]},toString:function(){return"["+this.getType()+" "+this.data.name+"]"},find:function(a){return $(this.target).find(a)},destroy:function(){for(var a in this._views)this.views[a].destroy();for(var a in this._elements)delete this.elements[a];delete this.target,delete this.parent}}).include(Events),b.views={view:b},b.prototype.types="ui-view ",b.extend=function(a){var c=Class.extend.call(this,a),d=a.getType(),e=["getType"];for(var f=0,g=e.length;f<g;f++){if(!a.hasOwnProperty(e[f]))throw"Class missing '"+e[f]+"()' implementation";c[e[f]]=a[e[f]]}return c.prototype.types+=d+" ",c.extend=arguments.callee,b.views[d]=c},b.get=function(a){if(a=="ui-view")return this;if(!this.views.hasOwnProperty(a))throw"View '"+a+'" not found';return this.views[a]},a.ViewController=b}(Clementine),function(a){var b={},c={};b.get=function(a,b,d){var e=this,f=[],g;if(!c.hasOwnProperty(a))throw"Path "+a+" has not been loaded";$("<div>"+c[a]+"</div>").children().each(function(){f.push($(this))});for(var h=0;h<f.length;h++){if(typeof b!="undefined"&&f[h].attr("data-control")!==b)continue;if(typeof d!="undefined"&&f[h].attr("data-name")!==d)continue;return f[h]}throw"Could not find view "+b+" at "+a},b.fetch=function(a,b,c){return $.ajax({async:c!==!0,cache:!1,contentType:"text/html; charset=utf-8",dataType:"text",timeout:1e4,url:"templates/"+a,success:function(c){b(a,c)},error:function(){throw"Error: template not found"}}).responseText},b.load=function(a,b){function f(a,d){c[a]=d,e--,e===0&&b()}var d,e=a.length;for(var g=0;g<a.length;g++)d=a[g],this.fetch(a[g],proxy(f,this))},a.View=b}(Clementine),function(a){var b={};b=Class.extend({initialize:function(a){this.prefix=a},setPrefx:function(a){this.prefix=a},getPrefix:function(){if(!this.prefix)throw{type:"Configuration Error",message:"Missing base url"};return this.prefix},request:function(a,b,c,d,e,f,g){if(!e||!f)throw{type:"Invalid Request",message:"Missing callback function"};d=d||function(a){return a},g=g||this,$.ajax({url:this.getPrefix()+a,type:b,timeout:3e4,data:c,success:function(a){if(a===null){f.call(g);return}try{a=JSON.parse(a)}catch(b){f.call(g);return}var c;try{c=d(a)}catch(h){f.call(g,h);return}e.call(g,c)},error:function(){f.call(g,!0)}})},modelOrId:function(a){a&&typeof a=="object"&&a.hasOwnProperty("id")&&(a=a.id);if(!a)return;return a}}),a.Service=b}(Clementine),function(a){var b,c=a.Loader,d=a.Service,e=a.View,f=a.ViewController;b=Class.extend({initialize:function(a){if(!a.hasOwnProperty("name")||(new RegExp(/[^A-Za-z:0-9_\[\]]/g)).test(a.name))throw"Invalid application name";this.loaded=!1,this.registered=!1,this.config=a,a.hasOwnProperty("views")&&e.register(a.views,Class.proxy(function(){this.registered=!0,this.loaded&&this.onLoad()},this)),window.onload=Class.proxy(function(){this.loaded=!0,this.registered&&this.onLoad()},this)},onLoad:function(){var a=$("[data-root]"),b=a.attr("data-control"),c=a.attr("data-name");if(typeof b=="undefined"||typeof c=="undefined")throw"Root view not found";a.removeAttr("data-root");var d=f.get(b),e=new d(null,a);e.on("load",function(){e.show()}),e.load(),this.root=e,$(window).bind("hashchange",Class.proxy(this.onHashChange,this)),$(window).trigger("hashchange")},onHashChange:function(){var a=location.hash;a?this.root.setState(a.replace("#","").split("/")):this.root.setState()}}),a.Application=b}(Clementine);